@page "/"
@rendermode InteractiveServer

@using Planner.Application.Messaging
@using Planner.BlazorApp.DataRepresentation
@using Planner.Contracts.Messages
@using Planner.Contracts.Messages.LinearSolver

@inject IMessageHubClient hub

<PageTitle>Home</PageTitle>
<h1>Linear Solver Inside</h1>

<h3>Welcome to the Linear Solver, perfect for optimizing your workflows!</h3>
<p>Please use any API clients to interact with the Linear Solver service...</p>


@if (results.Count == 0)
{
    <p><em>No results received yet...</em></p>
} else
{
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Request ID</th>
                <th>Status</th>
                <th>Objective Value</th>
                <th>Completed At</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var r in results)
            {
                <tr>
                    <td>@r.RequestId</td>
                    <td>@r.Status</td>
                    <td>@r.ObjectiveValue</td>
                    <td>@r.CompletedAt.ToLocalTime()</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private readonly List<LinearSolverResultRow> results = new();

    protected override Task OnInitializedAsync()
    {
        hub.SubscribeAsync<LinearSolverResultMessage>(MessageRoutes.LPSolverResult,
            r => InvokeAsync(() => {
                Console.WriteLine($"MessageHub received data {MessageRoutes.LPSolverResult}.");
                results.Add(new LinearSolverResultRow(r));
                StateHasChanged();
            })
        );
        return Task.CompletedTask;
    }
}
