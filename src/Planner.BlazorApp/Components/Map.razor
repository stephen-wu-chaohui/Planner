
@using Planner.Application.Messaging
@using Planner.Contracts.Messages
@using Planner.Contracts.Messages.LinearSolver
@using Planner.Contracts.Messages.VehicleRoutingProblem

@namespace Planner.BlazorApp.Components

@inject IMessageHubClient hub  // your existing abstraction over SignalR

    <GoogleMap DepotLat="-31.9505"
               DepotLon="115.8605"
               Routes="@routes"
               Height="100%" />

@code {
    private List<GoogleMap.RouteDto> routes = new();


    protected override async Task OnInitializedAsync()
    {
        await hub.SubscribeAsync<VrpResultMessage>(
            MessageRoutes.VRPSolverResult,
            result => InvokeAsync(() => {
                Console.WriteLine($"MessageHub received data {MessageRoutes.LPSolverResult}.");
                routes = ConvertToRoutes(result);
                StateHasChanged();
            }));
    }

    private static List<GoogleMap.RouteDto> ConvertToRoutes(VrpResultMessage msg)
    {
        // adapt this based on your real message contract
        var list = new List<GoogleMap.RouteDto>();
        foreach (var vehicle in msg.Response.Vehicles)
        {
            list.Add(new GoogleMap.RouteDto {
                VehicleId = vehicle.VehicleId,
                Points = vehicle.Stops.Select(s => new GoogleMap.RoutePoint {
                    Lat = s.Latitude,
                    Lon = s.Longitude
                }).ToList()
            });
        }
        return list;
    }

    public Task ClearRoutesAsync()
    {
        routes = new();
        StateHasChanged();
        return Task.CompletedTask;
    }
}
