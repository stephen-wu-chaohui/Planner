@page "/logout"

@using Planner.BlazorApp.Auth
@using Planner.BlazorApp.Services

@inject IJwtTokenStore TokenStore
@inject NavigationManager Nav
@inject PlannerApiClient ApiClient


<button @onclick="doCheck">Check</button>

<button @onclick="doLogout">Logout</button>

@if (error is not null) {
    <p style="color:red">@error</p>
}

@code {
    private string? error;

    private void doLogout() {
        TokenStore.Clear();
        Nav.NavigateTo("/login");
    }

    private async Task doCheck() {
        if (!TokenStore.IsAuthenticated) {
            Console.WriteLine("!TokenStore.IsAuthenticated");
            return;
        }
        if (TokenStore.IsExpired()) {
            error = "Your session has expired. Please log in again.";
            return;
        }
        try {
            var response = await ApiClient.GetAsync("auth/claims");
            error = response.ToString();
        } catch (Exception ex) {
            error = ex.Message;
        }
    }

}
